<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" href="icon.png" type="image/png">
  <link rel="apple-touch-icon" href="icon.png">
  <title>æ¤œå®šçµæœ - æ­Œå‰²ã‚Šæ¤œå®š</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="styles.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Mochiy+Pop+One&display=swap" rel="stylesheet">
</head>

<style>
  .rank-display { font-family: "Mochiy Pop One", sans-serif; font-size: 1.8rem; color: #ff69b2; margin: 20px 0; text-shadow: 2px 2px 0 #fff; }
  .score-circle { width: 120px; height: 120px; border: 6px solid #ff69b2; border-radius: 50%; display: flex; flex-direction: column; justify-content: center; align-items: center; margin: 20px auto; background: #fff; box-shadow: 0 5px 15px rgba(255,105,178,0.2); }
  .score-num { font-size: 2.5rem; font-weight: 900; color: #ff69b2; }
  .share-btn { background: #000 !important; color: #fff !important; outline-color: #000 !important; box-shadow: 3px 3px 0px #333 !important; }
  .info-badges {
    margin-bottom: 15px;
    display: flex;
    justify-content: center;
    gap: 8px;
  }
  .badge {
    background: #fdfdfd;
    border: 1px solid #ffb6c1;
    color: #ff69b2;
    padding: 4px 12px;
    border-radius: 15px;
    font-size: 0.75rem;
    font-weight: bold;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
  }
</style>

<body class="locked">

  <div class="box result-box">
    <p class="result-label">ã‚ãªãŸã®æ¤œå®šçµæœã¯â€¦</p>
    <h2 id="rank" class="rank-display">åˆ¤å®šä¸­...</h2>

    <div class="score-container">
      <div class="score-circle">
        <span id="correct-count" class="score-num">0</span>
        <span class="score-unit">/ 10 å•</span>
      </div>
    </div>

    <div class="info-badges">
      <span id="display-group" class="badge">---</span>
      <span id="display-diff" class="badge">---</span>
    </div>

    <div class="message-area">
      <p id="comment" class="comment-text"></p>
    </div>

    <div class="result-buttons">
      <button id="share-btn" class="share-btn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor" style="vertical-align: middle; margin-right: 8px;">
            <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"></path>
        </svg>
        çµæœã‚’Xã§ã¤ã¶ã‚„ã
      </button>

      <button class="start-btn" onclick="location.href='group.html'">ã‚‚ã†ä¸€åº¦ã‚ãã¶</button>
      <button class="back-btn" onclick="location.href='index.html'">ãƒˆãƒƒãƒ—ã«æˆ»ã‚‹</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

  <script>
    // 1. ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
    const state = JSON.parse(localStorage.getItem("quizState"));

    if (!state) {
      location.href = "index.html";
    }

    // --- å…±é€šè¨­å®š ---
    const difficultyMap = { 
      "easy": "ã‚„ã•ã—ã„", 
      "normal": "ãµã¤ã†", 
      "hard": "ã‚€ãšã‹ã—ã„",
      "expert": "ã’ãã‚€ãš" 
    };

    const correct = state.correctCount || 0;
    const total = 10;
    const rate = (correct / total) * 100;

    // 2. ã‚°ãƒ«ãƒ¼ãƒ—åã¨é›£æ˜“åº¦ã®è¡¨ç¤ºåæ˜ 
    document.getElementById("display-group").textContent = state.group || "---";
    document.getElementById("display-diff").textContent = difficultyMap[state.difficulty] || state.difficulty;

    // 3. ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³
    let displayNum = 0;
    const countEl = document.getElementById("correct-count");
    const timer = setInterval(() => {
      if (displayNum >= correct) {
        clearInterval(timer);
      } else {
        displayNum++;
        countEl.textContent = displayNum;
      }
    }, 100);

    // 4. ãƒ©ãƒ³ã‚¯åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯
    let rank = "";
    let comment = "";

    if (rate === 100) {
      rank = "ğŸŒŸç¥æ¨ã—ç´šğŸŒŸ";
      comment = "å®Œç’§ã§ã™ï¼å…¨å•æ­£è§£ï¼<br>ã‚ãªãŸã¯é–“é•ã„ãªãã€ã“ã®ã‚°ãƒ«ãƒ¼ãƒ—ã®æ­Œå‰²ã‚Šã‚’å®Œå…¨ã«ç†è§£ã—ã¦ã„ã¾ã™ã­ã€‚";
      launchConfetti();
    } else if (rate >= 80) {
      rank = "ğŸ¥‡ç‰©çŸ¥ã‚Šç´š";
      comment = "ã™ã”ã„ï¼ãƒã‚¤ãƒ¬ãƒ™ãƒ«ãªæ­£è§£ç‡ã§ã™ã€‚<br>ã‚ã¨ä¸€æ­©ã§å…¨å•æ­£è§£ã§ã—ãŸã€‚æƒœã—ã„ï¼";
    } else if (rate >= 50) {
      rank = "ğŸ¥ˆãƒ•ã‚¡ãƒ³ç´š";
      comment = "ãƒŠã‚¤ã‚¹ï¼ã‚ˆãçŸ¥ã£ã¦ã„ã¾ã™ã­ã€‚<br>ã‚‚ã£ã¨è´ãè¾¼ã‚ã°ã€ã•ã‚‰ã«æ­£è§£ãŒå¢—ãˆã‚‹ã¯ãšï¼";
    } else {
      rank = "ğŸ¥‰ãƒ“ã‚®ãƒŠãƒ¼ç´š";
      comment = "ã¾ãšã¯æ›²ã‚’ãŸãã•ã‚“è´ã„ã¦ã€<br>ãƒ¡ãƒ³ãƒãƒ¼ã®æ­Œå£°ã‚’èãåˆ†ã‘ã¦ã¿ã¾ã—ã‚‡ã†ï¼";
    }

    document.getElementById("rank").textContent = rank;
    document.getElementById("comment").innerHTML = comment;

    // 5. ç´™å¹é›ªã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
    function launchConfetti() {
      confetti({
        particleCount: 150,
        spread: 70,
        origin: { y: 0.6 },
        colors: ['#ff69b2', '#ffb6c1', '#ffffff', '#4ecdc4']
      });

      setTimeout(() => {
        confetti({
          particleCount: 50,
          angle: 60,
          spread: 55,
          origin: { x: 0 },
          colors: ['#ff69b2', '#ffb6c1']
        });
        confetti({
          particleCount: 50,
          angle: 120,
          spread: 55,
          origin: { x: 1 },
          colors: ['#ff69b2', '#ffb6c1']
        });
      }, 500);
    }

    // 6. Xï¼ˆTwitterï¼‰ã‚·ã‚§ã‚¢æ©Ÿèƒ½
    document.getElementById("share-btn").onclick = () => {
      const rankName = document.getElementById("rank").textContent;
      const score = document.getElementById("correct-count").textContent;
      const groupName = state.group; 
      const diffName = difficultyMap[state.difficulty] || state.difficulty;
      const siteUrl = "https://bunbunbunji.github.io/my-website/index.html";

      const text = encodeURIComponent(
        `æ­Œå‰²ã‚Šæ¤œå®šã®çµæœã¯â€¦\nã€${rankName}ã€‘ã§ã—ãŸï¼(æ­£è§£ï¼š${score}/10å•)\nã‚°ãƒ«ãƒ¼ãƒ—ï¼š${groupName}\né›£æ˜“åº¦ï¼š${diffName}\n${siteUrl}\n\n#KAWAIILABæ­Œå‰²ã‚Šæ¤œå®š`
      );

      const shareUrl = `https://twitter.com/intent/tweet?text=${text}`;
      window.open(shareUrl, '_blank', 'width=600,height=400');
    };
  </script>


</body>
</html>